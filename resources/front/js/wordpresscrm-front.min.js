function loadLookupData(e,t,o){var r=e.find(".crm-lookup-lookuptype").children(":selected").attr("value");jQuery.ajax({url:ajaxurl,data:{action:"retrieve_lookup_request",lookupType:r,pagingCookie:t,pageNumber:o},success:function(t){var r=jQuery.parseJSON(t);e.find(".crm-lookup-body-grid").html(r.data),r.pagingcookie&&(e.find(".crm-lookup-popup-next-page").attr("data-pagingcookie",e.find(".crm-lookup-popup-next-page").attr("data-pagingcookie")),e.find(".crm-lookup-popup-next-page").attr("data-pagingcookie",r.pagingcookie),e.find(".crm-lookup-popup-prev-page").attr("data-pagingcookie",r.pagingcookie)),o>1?(e.find(".crm-lookup-popup-first-page").removeAttr("disabled"),e.find(".crm-lookup-popup-prev-page").removeAttr("disabled")):(e.find(".crm-lookup-popup-first-page").attr("disabled","disabled"),e.find(".crm-lookup-popup-prev-page").attr("disabled","disabled")),"0"!==r.morerecords?e.find(".crm-lookup-popup-next-page").removeAttr("disabled"):e.find(".crm-lookup-popup-next-page").attr("disabled","disabled"),e.find(".body-row").first().addClass("selected-row"),e.find(".crm-lookup-popup-body-loader").fadeOut(),bindPopupOnClick()},error:function(t){e.find(".crm-lookup-body-grid").html(t)}})}function searchLookupData(e,t){var o=e.find(".crm-lookup-lookuptype").children(":selected").attr("value");jQuery.ajax({url:ajaxurl,data:{action:"search_lookup_request",lookupType:o,searchstring:encodeURIComponent(t)},success:function(t){e.find(".crm-lookup-body-grid").html(t),e.find(".body-row").first().addClass("selected-row"),bindPopupOnClick(),e.find(".crm-lookup-popup-first-page").attr("disabled","disabled"),e.find(".crm-lookup-popup-prev-page").attr("disabled","disabled"),e.find(".crm-lookup-popup-next-page").attr("disabled","disabled"),e.find(".crm-lookup-popup-body-loader").fadeOut()},error:function(e){console.log(e)}})}function bindPopupOnClick(){jQuery(".body-row").on("click",function(){jQuery(this).hasClass("selected-row")?jQuery(this).parent().children(".body-row").removeClass("selected-row"):(jQuery(this).parent().children(".body-row").removeClass("selected-row"),jQuery(this).addClass("selected-row")),jQuery(this).parent().find(".selected-row").length<1?jQuery(this).parent().parent().parent().parent().parent().find(".crm-popup-add-button").attr("disabled","disabled"):jQuery(this).parent().parent().parent().parent().parent().find(".crm-popup-add-button").removeAttr("disabled","disabled")})}window.jQuery&&(jQuery(document).ready(function(){jQuery(".crm-datepicker").datetimepicker({timepicker:!1,format:"m/d/Y"}),jQuery(".crm-datetimepicker").datetimepicker({format:"m/d/Y H:s"}),"undefined"!=typeof jQuery.widget&&jQuery.isFunction(jQuery.widget)&&(!function(e){e.widget("custom.combobox",{_create:function(){this.wrapper=e("<span>").addClass("custom-combobox").insertAfter(this.element),this.element.hide(),this._createAutocomplete(),this._createShowAllButton()},_createAutocomplete:function(){var t=this.element.children(":selected"),o=t.val()?t.text():"";this.input=e("<input>").appendTo(this.wrapper).val(o).attr("title","").addClass("custom-combobox-input ui-widget ui-widget-content ui-state-default ui-corner-left").autocomplete({delay:0,minLength:0,source:e.proxy(this,"_source")}).tooltip({tooltipClass:"ui-state-highlight"}),this._on(this.input,{autocompleteselect:function(e,t){t.item.option.selected=!0,this._trigger("select",e,{item:t.item.option})},autocompletechange:"_removeIfInvalid"})},_createShowAllButton:function(){var t=this.input,o=!1;e("<a>").attr("tabIndex",-1).attr("title","Show All Items").appendTo(this.wrapper).button({icons:{primary:"ui-icon-triangle-1-s"},text:!1}).removeClass("ui-corner-all").addClass("custom-combobox-toggle ui-corner-right").mousedown(function(){o=t.autocomplete("widget").is(":visible")}).click(function(){t.focus(),o||t.autocomplete("search","")})},_source:function(t,o){var r=new RegExp(e.ui.autocomplete.escapeRegex(t.term),"i");o(this.element.children("option").map(function(){var o=e(this).text();return!this.value||t.term&&!r.test(o)?void 0:{label:o,value:o,option:this}}))},_removeIfInvalid:function(t,o){if(!o.item){var r=this.input.val(),a=r.toLowerCase(),p=!1;this.element.children("option").each(function(){return e(this).text().toLowerCase()===a?(this.selected=p=!0,!1):void 0}),p||(this.input.val("").attr("title",r+" didn't match any item").tooltip("open"),this.element.val(""),this._delay(function(){this.input.tooltip("close").attr("title","")},2500),this.input.autocomplete("instance").term="")}},_destroy:function(){this.wrapper.remove(),this.element.show()}})}(jQuery),jQuery(function(){jQuery(".alexacombobox").combobox()})),jQuery(".crm-popup-add-button").on("click",function(e){if(e.preventDefault(),"undefined"==typeof jQuery(this).attr("disabled")){var t=jQuery(this).parent().parent().parent(),o=t.find(".body-row.selected-row").attr("data-enitityid"),r=t.find(".body-row.selected-row").attr("data-name");t.parent().parent().find(".crm-lookup-textfield").attr("value",r),t.parent().parent().find(".crm-lookup-hiddenfield").attr("value",o),t.parent().parent().find(".crm-lookup-textfield-delete-value").show(),t.parent().parent().find(".crm-popup-remove-value-button").removeAttr("disabled"),t.parent().fadeOut()}return!1}),jQuery(".crm-lookup-popup-overlay-bg, .crm-popup-cancel, .crm-popup-cancel-button").on("click",function(e){return e.preventDefault(),jQuery(".crm-lookup-popup-overlay").fadeOut(),!1}),jQuery(".crm-lookup-textfield-button").on("click",function(){jQuery(this).parent().parent().children(".crm-lookup-popup-overlay").fadeIn();var e=jQuery(this).parent().parent();e.find(".lookup-table").length||(e.find(".crm-lookup-popup-body-loader").fadeIn(),loadLookupData(e)),""!==e.parent().parent().find(".crm-lookup-hiddenfield").attr("value")&&e.find(".crm-popup-remove-value-button").removeAttr("disabled")}),jQuery(".crm-popup-remove-value-button").on("click",function(e){if(e.preventDefault(),"undefined"==typeof jQuery(this).attr("disabled")){var t=jQuery(this).parent().parent().parent();t.parent().parent().find(".crm-lookup-textfield").attr("value",""),t.parent().parent().find(".crm-lookup-hiddenfield").attr("value",""),t.parent().parent().find(".crm-lookup-textfield-delete-value").hide(),t.parent().fadeOut(),jQuery(this).attr("disabled","disabled")}return!1}),jQuery(".crm-lookup-lookuptype").on("change",function(){var e=jQuery(this).parent().parent().parent().parent().parent().parent();e.find(".crm-lookup-popup-body-loader").fadeIn(),loadLookupData(e)}),jQuery(".crm-lookup-searchfield-button").on("click",function(){var e=jQuery(this).parent().children(".crm-lookup-searchfield"),t=e.parent().parent().parent().parent().parent().parent();t.find(".crm-lookup-popup-body-loader").fadeIn(),jQuery(this).hide(),jQuery(this).parent().children(".crm-lookup-searchfield-delete-search").show(),searchLookupData(t,e.val())}),jQuery(".crm-lookup-searchfield-delete-search").on("click",function(){var e=jQuery(this).parent().children(".crm-lookup-searchfield"),t=e.parent().parent().parent().parent().parent().parent();jQuery(this).hide(),jQuery(this).parent().children(".crm-lookup-searchfield-button").show(),e.val(""),t.find(".crm-lookup-popup-body-loader").fadeIn(),searchLookupData(t,e.val())}),jQuery(".crm-lookup-textfield-delete-value").on("click",function(){jQuery(this).parent().children(".crm-lookup-textfield").val(""),jQuery(this).parent().children(".crm-lookup-hiddenfield").val(""),jQuery(this).hide()}),jQuery(".crm-lookup-popup-first-page").on("click",function(e){if(e.preventDefault(),"undefined"==typeof jQuery(this).attr("disabled")){var t=jQuery(this).parent().parent().parent().parent().parent().parent().parent();t.find(".crm-lookup-popup-body-loader").fadeIn(),loadLookupData(t),t.find(".crm-lookup-popup-page-counter").html("1"),jQuery(this).attr("disabled","disabled")}return!1}),jQuery(".crm-lookup-popup-prev-page").on("click",function(e){if(e.preventDefault(),"undefined"==typeof jQuery(this).attr("disabled")){var t=jQuery(this).parent().parent().parent().parent().parent().parent().parent();t.find(".crm-lookup-popup-body-loader").fadeIn();var o=jQuery(this).attr("data-pagingcookie"),r=parseInt(t.find(".crm-lookup-popup-page-counter").html());1==r||(2==r?(loadLookupData(t),t.find(".crm-lookup-popup-page-counter").html("1")):(t.find(".crm-lookup-popup-page-counter").html(r-1),loadLookupData(t,o,r-1)))}return!1}),jQuery(".crm-lookup-popup-next-page").on("click",function(e){if(e.preventDefault(),"undefined"==typeof jQuery(this).attr("disabled")){var t=jQuery(this).parent().parent().parent().parent().parent().parent().parent();t.find(".crm-lookup-popup-body-loader").fadeIn();var o=jQuery(this).attr("data-pagingcookie"),r=parseInt(t.find(".crm-lookup-popup-page-counter").html());t.find(".crm-lookup-popup-page-counter").html(r+1),loadLookupData(t,o,r+1)}return!1})}),jQuery(document).keypress(function(e){if(13==e.which&&jQuery(".crm-lookup-searchfield").is(":focus")){var t=jQuery(".crm-lookup-searchfield:focus"),o=t.parent().parent().parent().parent().parent().parent();o.find(".crm-lookup-searchfield-button").hide(),o.find(".crm-lookup-searchfield-delete-search").show(),o.find(".crm-lookup-popup-body-loader").fadeIn(),searchLookupData(o,t.val())}}));
